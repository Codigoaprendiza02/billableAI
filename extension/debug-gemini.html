<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Gemini Integration</title>
</head>
<body>
    <h1>Debug Gemini Integration</h1>
    <div id="results"></div>

    <script type="module">
        import configService from './src/services/configService.js';
        import GeminiService from './src/services/geminiService.js';

        async function debugGeminiIntegration() {
            const resultsDiv = document.getElementById('results');
            let debugLog = [];
            
            function log(message) {
                console.log(message);
                debugLog.push(message);
            }
            
            try {
                log('üîß Starting Gemini integration debug...');
                
                // Step 1: Test backend connectivity
                log('üìã Step 1: Testing backend connectivity...');
                try {
                    const response = await fetch('http://localhost:3001/api/config/config');
                    if (response.ok) {
                        const config = await response.json();
                        log(`‚úÖ Backend connected! Received config with keys: ${Object.keys(config).join(', ')}`);
                        log(`üìã Gemini API Key: ${config.geminiApiKey ? config.geminiApiKey.substring(0, 10) + '...' : 'not set'}`);
                    } else {
                        log(`‚ùå Backend responded with status: ${response.status}`);
                    }
                } catch (error) {
                    log(`‚ùå Backend connection failed: ${error.message}`);
                }
                
                // Step 2: Test ConfigService
                log('üìã Step 2: Testing ConfigService...');
                try {
                    const testResult = await configService.testConfigImport();
                    log(`‚úÖ ConfigService test result: ${JSON.stringify(testResult)}`);
                } catch (error) {
                    log(`‚ùå ConfigService test failed: ${error.message}`);
                }
                
                // Step 3: Test GeminiService initialization
                log('üéØ Step 3: Testing GeminiService initialization...');
                try {
                    const gemini = new GeminiService();
                    await gemini.initialize();
                    
                    const isReady = gemini.isReady();
                    const apiKey = gemini.getApiKey();
                    
                    log(`‚úÖ GeminiService initialized. Ready: ${isReady}, Has API Key: ${!!apiKey}`);
                    if (apiKey) {
                        log(`üìã API Key: ${apiKey.substring(0, 10)}...`);
                    }
                } catch (error) {
                    log(`‚ùå GeminiService initialization failed: ${error.message}`);
                }
                
                // Step 4: Test connection
                log('üîó Step 4: Testing Gemini connection...');
                try {
                    const gemini = new GeminiService();
                    await gemini.initialize();
                    const connectionTest = await gemini.testConnection();
                    log(`‚úÖ Connection test result: ${JSON.stringify(connectionTest)}`);
                } catch (error) {
                    log(`‚ùå Connection test failed: ${error.message}`);
                }
                
                // Step 5: Test summary generation
                log('üìù Step 5: Testing summary generation...');
                try {
                    const gemini = new GeminiService();
                    await gemini.initialize();
                    
                    const testEmailData = {
                        subject: 'Test Email',
                        to: 'test@example.com',
                        body: 'This is a test email for debugging.'
                    };
                    
                    const summary = await gemini.generateBillableSummary(testEmailData, 300000);
                    log(`‚úÖ Summary generation successful! Length: ${summary?.length || 0} characters`);
                    log(`üìã Summary preview: ${summary?.substring(0, 100)}...`);
                } catch (error) {
                    log(`‚ùå Summary generation failed: ${error.message}`);
                }
                
                // Display results
                resultsDiv.innerHTML = `
                    <h2>Debug Results:</h2>
                    <pre>${debugLog.join('\n')}</pre>
                `;
                
            } catch (error) {
                log(`‚ùå Debug failed: ${error.message}`);
                resultsDiv.innerHTML = `
                    <h2>Debug Failed:</h2>
                    <pre>${debugLog.join('\n')}</pre>
                    <h3>Error:</h3>
                    <pre>${error.message}</pre>
                `;
            }
        }

        debugGeminiIntegration();
    </script>
</body>
</html> 